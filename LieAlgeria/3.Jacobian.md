# 函数关于姿态的求导

**1. 使用李代数表示姿态，根据李代数加法来对李代数求导。即：在李代数上加上小的增量$$\delta \xi$$，对该李代数增量$$\delta \xi$$进行求导**
$$
\frac{\partial (exp(\phi^{\wedge}p))}{\partial \phi} = \lim_{\delta \phi\rightarrow 0}\frac{exp((\phi+\delta \phi)^{\wedge})p-exp(\phi ^{\wedge})p}{\delta \phi}
$$

**2. 使用李群左乘或右乘微小的扰动$$\delta T$$，然后对该扰动对应的李代数求导$$\xi$$** 
$$
\frac{\partial (Tp)}{\partial \xi} = \lim_{\xi\rightarrow 0}\frac{exp(\xi^{\wedge}))exp(\phi^{\wedge})p -exp(\phi ^{\wedge})p}{\xi}
$$



# 空间点经位姿变换后对点和对位姿求导

 ## 1.1 SO(3)=Rp

描述：一个点经过SO3变换后的位置对SO3求导





<u>**使用李代数的加法对李代数的增量进行求导**</u>
$$
\frac{\partial (exp(\phi^{\wedge}p))}{\partial \phi} = \lim_{\delta \phi\rightarrow 0}\frac{exp((\phi+\delta \phi)^{\wedge})p-exp(\phi ^{\wedge})p}{\delta \phi}
$$
参考【1.Define】中的扰动对应的公式
$$
exp((\phi+\Delta\phi)^\wedge ) = exp((J_l\Delta \phi)^\wedge )exp(\phi^{\wedge})
$$
上市可以简化为：
$$
=\lim_{\delta \phi\rightarrow 0}\frac{exp(J_l(\phi)\delta \phi)^\wedge )exp(\phi^{\wedge})p-exp(\phi ^{\wedge})p}{\delta \phi}
$$

$$
=\lim_{\delta \phi\rightarrow 0}\frac{(I+(J_l(\phi)\delta\phi)^{\wedge})exp(\phi^{\wedge})p-exp(\phi ^{\wedge})p}{\delta \phi}
$$

$$
=\lim_{\delta \phi\rightarrow 0}\frac{(J_l(\phi)\delta\phi)^{\wedge}exp(\phi^{\wedge})p}{\delta \phi}
$$

利用常用公式
$$
a \times  b = -b \times a
$$
所以
$$
=\lim_{\delta \phi\rightarrow 0}\frac{-[exp(\phi^{\wedge})p]^{\wedge}(J_l(\phi)\delta\phi)}{\delta \phi}
$$

$$
=\lim_{\delta \phi\rightarrow 0}=-(exp(\phi^{\wedge})p)^{\wedge}J_l(\phi)
$$

$$
=-(Rp)^{\wedge}J_l(\phi)
$$

通常取$J_l$的近似I，所以有$=-(Rp)^{\wedge}$





<u>**使用扰动模块，对R的扰动$\Delta R$ 对应的李代数$\Delta\phi$进行求导**</u>
$$
\frac{\partial (Rp)}{\partial \Delta \phi} = \lim_{\Delta \phi\rightarrow 0}\frac{exp(\Delta \phi^{\wedge}))exp(\phi^{\wedge})p -exp(\phi ^{\wedge})p}{\Delta \phi}
$$

$$
= \lim_{\Delta \phi\rightarrow 0}\frac{(I+\Delta \phi^{\wedge})exp(\phi^{\wedge})p -exp(\phi ^{\wedge})p}{\Delta \phi}
$$

$$
= \lim_{\Delta \phi\rightarrow 0}\frac{\Delta \phi^{\wedge}exp(\phi^{\wedge})p}{\Delta \phi}
$$

利用常用公式
$$
a \times  b = -b \times a
$$
所以
$$
= \lim_{\Delta \phi\rightarrow 0}\frac{-(exp(\phi^{\wedge})p)^{\wedge}\Delta \phi}{\Delta \phi}
$$

$$
=-(exp(\phi^{\wedge})p)^{\wedge}
$$

$$
=-(Rp)^{\wedge}
$$



### 1.2 SE(3) = Tp

描述：一个点经过SE3变换后的位置对SE3求导

<u>**使用扰动模块，对T的扰动$\Delta T$对应的李代数$\Delta \varepsilon $进行求导**</u>
$$
\frac{\partial (Tp)}{\partial \Delta \varepsilon } = \lim_{\Delta  \varepsilon \rightarrow 0}\frac{exp(\Delta  \varepsilon ^{\wedge}))exp( \varepsilon ^{\wedge})p -exp( \varepsilon  ^{\wedge})p}{\Delta  \varepsilon }
$$

$$
= \lim_{\Delta \varepsilon \rightarrow 0}\frac{(I+\Delta \varepsilon ^{\wedge})exp(\varepsilon ^{\wedge})p -exp(\varepsilon ^{\wedge})p}{\Delta \varepsilon }
$$

$$
= \lim_{\Delta \varepsilon \rightarrow 0}\frac{\Delta  \varepsilon ^{\wedge}exp( \varepsilon ^{\wedge})p}{\Delta  \varepsilon } =  \lim_{\Delta \varepsilon \rightarrow 0}\frac{\Delta  \varepsilon ^{\wedge}Tp}{\Delta  \varepsilon }
$$

这里不能利用公式$a \times  b = -b \times a$来变换位置，因此只对反对以矩阵才有这个执行，而$\varepsilon^{\wedge}$ 和$\xi{\wedge}$ 都是4x4的，不具备此性质，只能按照定义来

**分子**
$$
\Delta  \varepsilon ^{\wedge}Tp = \begin{bmatrix}
 \Delta\phi^{\wedge}&\Delta\rho \\ 
 0^T&0 
\end{bmatrix}\begin{bmatrix}
R &t \\ 
 0&1 
\end{bmatrix}p = \begin{bmatrix}
\Delta\phi^{\wedge} &\Delta\rho \\ 
 0^T&0 
\end{bmatrix}\begin{bmatrix}
Rp+t\\ 
1
\end{bmatrix}=\begin{bmatrix}
 \Delta \phi^{\wedge}(Rp+t) + \Delta \rho \\ 
 1
\end{bmatrix}
$$

$$
\Delta  \varepsilon ^{\wedge}Tp =\begin{bmatrix}
 \Delta \phi^{\wedge}p_c + \Delta \rho \\ 
 0
\end{bmatrix} = \begin{bmatrix}
 -{p_c}^{\wedge}\Delta \phi + \Delta \rho \\ 
 0
\end{bmatrix}  --(1)
$$

其中：$p_c = Rp+t$

**分母：r在前t在后**
$$
\Delta  \varepsilon  = \begin{bmatrix}
\Delta \phi\\ 
\Delta \rho
\end{bmatrix}--(2)
$$
**分母**：r在前r在后
$$
\Delta  \varepsilon  = \begin{bmatrix}
\Delta \rho \\ 
\Delta \phi
\end{bmatrix}--(2)
$$
所以： $\frac{\partial (Tp)}{\partial \Delta \varepsilon } =\lim_{\Delta \varepsilon\rightarrow 0 } \frac{(1)}{(2)}$ , 反推思想$\frac{\partial (Tp)}{\partial \Delta \varepsilon } * (2)  = (1)$



**1.当对应李代数是：r在前t在后**
$$
A\begin{bmatrix}
\Delta \phi\\ 
\Delta \rho
\end{bmatrix} =  \begin{bmatrix}
 -{p_c}^{\wedge}\Delta \phi + \Delta \rho \\ 
 0 \end{bmatrix}
$$

$$
A =  \begin{bmatrix}
 -{p_c}^{\wedge} & I\\ 
0^T & 0
\end{bmatrix}--(3)
$$

**2.当对应李代数是：t在前r在后**
$$
A\begin{bmatrix}
\Delta \rho\\
\Delta \phi
\end{bmatrix} =  \begin{bmatrix}
 -{p_c}^{\wedge}\Delta \phi + \Delta \rho \\ 
 0 \end{bmatrix}
$$

$$
A =  \begin{bmatrix}
 I &  -{p_c}^{\wedge} \\
0^T & 0
\end{bmatrix}--(4)
$$

注意：g2o库定义的SE是t在前r在后，因此用公式（4）



### 1.3 Sim3 = Sp

